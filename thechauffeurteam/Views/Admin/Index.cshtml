@model IEnumerable<thechauffeurteam.Models.job>
@{
    ViewBag.Title = "Admin";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<link href="~/style/AdminIndex.css" rel="stylesheet" />
<style>

    #body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height:52vh;
        width: 100%;
        font-family: sans-serif;
        background: #007180;
    }

    .text-box {
        width: 1400px;
        height: 400px;
        overflow-y: scroll;
        background: #fff;
        box-shadow: 0px 10px 100px rgba(0,0,0,0);
    }

    table {
        width: 100%;
    }

        table th td {
            border: 1px solid #005277;
            border-collapse: collapse;
            text-align: center;
        }

        table td {
            width: 210px;
            font-size: 11px;
        }

        table :hover {
            background-color:aquamarine;
            color:white;
        }

    th {
        position: sticky;
        top: 0;
        /*width:290px;*/
        background: blue;
        color: #fff;
    }

    tr th:nth-child() {
        width: 60px;
        text-align: center;
        background-color: #03707d;
    }

    tr td:nth-child() {
       
        background: #00bc64;
        color: #fff;
    }
</style>
<style>


    #table tr th {
        width: 110px;
    }

    #table tr td {
        width: 170px;
        font-size: 12px;
    }

    #td {
        max-width: 10px;
        padding: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .form-group {
        padding: 0px;
        margin-top: 0px;
        height: 30px;
    }

    #btn1 {
        width: 249px;
        height: 45px;
        background-color: red;
    }

    #jbtn {
        width: 230px;
        background-color: blue;
        color: white;
    }
</style>
<!-- Header -->
<div class="header bg-gradient-primary pb-8 pt-4 pt-md-6 mb-4" style="width:1335px">
    @*<input type="text" id="search" class="form-control" placeholder="Search Any Query" style="text-align:center;width:510px;margin-left:40px;margin-top:8px;" />*@

    <div class="row mt-4 p-0">

        <div class="col-2">
            <input type="text" class="form-control" name="driverId" placeholder="Driver ID" style="margin-left:40px;width:250px;height:30px" />
        </div>

        <div class="col-2">
            <input type="text" class="form-control" name="jobId" placeholder="Job Id" style="margin-left:70px;width:250px;height:30px" />
        </div>

        <div class="col-2">
            <input type="text" class="form-control" name="startdate" placeholder="Start Date" style="margin-left:100px;width:250px;height:30px" />
        </div>


        <div class="col-2">
            <input type="text" class="form-control" name="starttime" placeholder="Start Time" style="margin-left:132px;width:235px;height:30px" />
        </div>


        <div class="col-2">
            <input type="text" class="form-control" name="endDate" placeholder="End Date" style="margin-left:150px;width:245px;height:30px" />
        </div>


    </div>


    <div class="row mt-2">

        <div class="col-2">
            <input type="text" class="form-control" name="endtime" placeholder="End Time" style="margin-left:40px;width:250px;height:30px" />
        </div>

        <div class="col-2">
            <input type="text" class="form-control" name="pname" placeholder="Passenger Name" style="margin-left:70px;width:250px;height:30px" />
        </div>

        <div class="col-2">
            <input type="text" class="form-control" name="phone" value="phone" placeholder="Phone Number" style="margin-left:100px;width:250px;height:30px" />
        </div>


        <div class="col-2">
            <input type="text" class="form-control" name="account" placeholder="Account Number" style="margin-left:133px;width:235px;height:30px" />
        </div>


        @*<div class="col-2">
                <input type="submit" class="btn" value="Save" id="btn1" style="margin-left:149px;height:30px" />
            </div>*@

        <div class="col-1"></div>
    </div>

</div>

<div class="container-fluid mt--8 m">
    <!-- Table -->
    <div class="row">
        <div class="col">
            <div class="card shadow">
                <div class="card-header border-0">
                    @*<h3 class="mb-0">Jobs</h3>*@

                    <a href="" class="btn" id="jbtn">UpComing Jobs</a>
                    <a href="" class="btn" id="jbtn">Active Jobs</a>
                    <a href="" class="btn" id="jbtn">Completed Jobs</a>
                    <a href="" class="btn" id="jbtn">cancelled Jobs</a>
                    <a href="" class="btn" id="jbtn">All Jobs</a>

                    @*<a href="" class="btn btn-primary" id="jbtn">UpComing</a>*@
                </div>
                <div id="body">
                    <div class="text-box">
                        <table cellpadding="10" class=" table-hover" style="width:100% !important" id="">
                            <thead id="">
                                <tr>
                                    <th style="width:100px">JobId</th>
                                    <th class="ml-4">Time/Date</th>
                                    <th>PickUp</th>
                                    <th>Drop Off</th>
                                    <th>Price</th>
                                    <th>Via</th>

                                    <th>vehicle</th>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>JobType</th>
                                    <th>AC.No</th>
                                   <th style="width:100px"></th>
                                </tr>
                            </thead>
                            @*<thead class="bg-blue">
                                <tr class="text-light px-1">
                                    <th scope="col" class="text-light px-1 ml-0 px-0 text-center">JobId</th>
                                    <th scope="col" class="text-light px-0 mx-0 text-center">Time/Date</th>
                                    <th scope="col" class="text-light px-0 text-center">Pick Up</th>
                                    <th scope="col" class="text-light px-0 text-center">Drop Off</th>
                                       <th scope="col" class="text-light px-0 text-center">Price</th>
                                        <th scope="col" class="text-light px-0 text-center">Via</th>
                                        <th scope="col" class="text-light px-0 text-center">Vehicle</th>
                                        <th scope="col" class="text-light px-0 text-center">Name</th>


                                    <th scope="col" class="text-light px-0 text-center">Phone</th>

                                    <th scope="col" class="text-light px-0 text-center">JobType</th>
                                         <th scope="col" class="text-light px-0 text-center">AC</th>
                                        @*<th scope="col" class="text-light px-0 text-center">Miles</th>
                                                <th class=" px-0"></th>
                                                </tr>
                                                </thead>*@
                            <tbody class="bg-white" style=" height:360px!important; margin-left:2px;padding:2px" id="tbdy">
                                <tr>
                                    @foreach (var value in Model)
                                    {


                                    @*<tr class=" px-1" style="">
                                        @switch (value.status)
                                        {

                                            case 1:

                                                {
                                                    <td class="py-0 my-0 px-1 mr-0" style="max-width:50px;">
                                                        <span class="badge badge-dot">
                                                            <i class="bg-warning"></i><text class="text-warning">Active</text>
                                                        </span>
                                                    </td>
                                                    break;
                                                }
                                            case 2:
                                                {
                                                    <td class="py-0 my-0  px-1" style="max-width:50px">
                                                        <span class="badge badge-dot mr-4">
                                                            <i class="bg-success"></i> <text class="text-success">Finished</text>
                                                        </span>
                                                    </td>
                                                    break;
                                                }
                                            case 3:
                                                {
                                                    <td class="py-0 my-0 px-1" style="max-width:50px">
                                                        <span class="badge badge-dot mr-4">
                                                            <i class="bg-danger"></i> <text class="text-danger">Canceled</text>
                                                        </span>
                                                    </td>
                                                    break;
                                                }

                                                @*default:
                                                    {
                                                        <td class="py-1 my-0 px-2" style="max-width:50px">
                                                            <span class="badge badge-dot mr-4">
                                                                <i class="bg-info"></i><text class="text-info">New</text>
                                                            </span>
                                                        </td>
                                                        break;
                                                    }
                                        }

                                    </tr>*@

                                    <tr>
                                        @*<td>@value.DriverId</td>*@
                                        <td style="width:100px">@value.id</td>
                                        <td id="time">@value.dateAndTime</td>
                                        <td id="td" style="width:200px">@value.pickUp</td>
                                        <td id="td" style="width:285px">@value.DropUP</td>

                                        <td style="width:150px"><i class="fas fa-pound-sign"></i> 5 </td>
                                        <td id="td" style="width:225px;margin-left:10px">Multan</td>
                                        <td style="width:150px">Mehran</td>
                                        <td style="width:150px">@value.PassengerName</td>
                                        <td style="width:120px">03085488943</td>
                                        <td style="width:120px">Cash</td>
                                        <td id="td" style="width:120px;margin-left:100px" class="ml-8">43502-5421-eff-255</td>

                                        <td class="text-right py-1 my-0 px-0" style="width:100px">
                                            <div class="dropdown">
                                                <a class="btn btn-sm btn-icon-only text-light" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-ellipsis-v"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                                    @{
                                                        var id = @value.id;
                                                    }
                                                    <a class="dropdown-item" href="" onclick="jobInfo(@id)" data-toggle="modal" data-target="#jobModal">Info</a>
                                                    <a class="dropdown-item" href="" onclick="DirectAllocateJob(@id)" data-toggle="modal" data-target="#jobModal">Allocate</a>
                                                    <a class="dropdown-item" href="" onclick="setCancelJobId(@id)" data-toggle="modal" data-target="#cancelConfr">Cancel</a>
                                                </div>
                                            </div>
                                        </td>

                                    </tr>








                                }




                                    @*<table class="table-striped  bg-white ml--3 mt-0" style="width:101.1%;height:25px" id="table">
                                        <thead id="thd" style="background-color:blue;">
                                            <tr>
                                                <th style="width:90px">JobId</th>
                                                <th>Time/Date</th>
                                                <th>PickUp</th>
                                                <th style="width:165px">Drop Off</th>
                                                <th class="ml-8">Price</th>
                                                <th style="width:165px">Via</th>

                                                <th class="ml--4">vehicle</th>
                                                <th>Name</th>
                                                <th>Phone</th>
                                                <th>JobType</th>
                                                <th>AC.No</th>
                                            </tr>
                                        </thead>*@
                                    @*<tbody style=" height:390px!important;" id="tbdy">*@



                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>

        </div>
    </div>


    @Html.Partial("_JobModal")

    <!-- Footer -->
    <footer class="footer" style="padding:0px">
        <div class="row align-items-center justify-content-xl-between">
            <div class="col-xl-12">
                <div class="copyright text-center text-xl-left text-muted">
                    &copy; 2018 itLogi Solutions
                </div>
            </div>
        </div>
    </footer>



    <div onload="ModalLoad()" class="modal fade" id="cancelConfr" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-notify" role="document" style="width:1000px">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title text-white">Alert</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-danger">
                    Do you realy want to cancel this Job?
                    <input type="hidden" id="cancelJobId" value="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                    <button type="button" class="btn btn-danger" onclick="cancelJob()" data-dismiss="modal">Yes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Central Modal Medium Success -->
    <div class="modal fade" id="centralModalSuccess" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-notify modal-success" role="document">
            <!--Content-->
            <div class="modal-content">
                <!--Header-->
                <div class="modal-header">
                    <p class="heading lead">Modal Success</p>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" class="white-text">&times;</span>
                    </button>
                </div>
                <!--Body-->
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fa fa-check fa-4x mb-3 animated rotateIn"></i>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Impedit iusto nulla aperiam blanditiis
                            ad consequatur in dolores culpa, dignissimos, eius non possimus fugiat. Esse ratione fuga, enim,
                            ab officiis totam.
                        </p>
                    </div>
                </div>
                <!--Footer-->
                <div class="modal-footer justify-content-center">
                    <input type="button" class="btn btn-success" />Get it now <i class="fa fa-diamond ml-1 text-white"></i><input />
                    <input type="button" class="btn btn-outline-success waves-effect" data-dismiss="modal" />No, thanks</input>

                </div>
            </div>
            <!--Content-->
        </div>
    </div>
    <!-- Central Modal Medium Success-->

    @section scripts{
        <script type="text/javascript">





        function jobInfo(Id) {
            //alert("success" + Id)


             $.ajax({
                type: "POST",
                 url: '@Url.Action("JobInfo", "Admin")',
                 data: { id: Id },
                 dataType: "json",

                 success: function (success) {

                         //alert('pick Up :'+success.pickUp);
                         var txt = $("#jobId").val();
                         $("#jobId").html(txt + success.jb.id);
                         $("#jid").val(success.jb.id);
                         $("#pickUpAddress").val(success.jb.pickUp);
                         $("#dropOffAddress").val(success.jb.DropUP);
                         $("#distance").val(success.jb.Mile);
                         $("#price").val(success.jb.Price);
                         $("#carType").val(success.jb.CarType);

                         var dAndT = "" + success.jb.dateAndTime;


                        $("#time").val(dAndT.substring(0, 10).trim());
                         $("#date").val(dAndT.substring(10).trim());
                         $("#driverMessage").val(success.jb.DriverMessage);

                         $("#name").val(success.jb.PassengerName);
                         $("#phone").val(success.jb.PassengerPhone);
                     $("#editJobId").val(success.jb.id);


                         var myOptions = success.drivers;
                         //var mySelect = ;
                         var select = $("#drivers");
                         // alert("length " + success.drivers.length);
                         $("#drivers").children().remove();
                         select.append($("<option>").val(0).html("Select Driver"));

                         $(success.drivers).each(function (index, item) {
                             //if (item.DriverId != null) {
                                 select.append($("<option>").val(item.Id).html(item.DriverId));
                             //}
                             //else {
                             //    select.append($("<option>").val(item.Id).html(item.DriverName));
                             //}
                         });
                         console.log(success);
                 },
                 error: function (e, text, string) {
                    //alert(e.message + text + string);
                    console.log(e);
                 }

            });


    };
    function onShowModal() {
        //alert("ook");
        $(".jobEditGroup").attr("readonly");
        $(".saveButton").attr("hidden");

        $(".jobEditGroup").add("readonly");
        $(".saveButton").add("hidden");
    }

        function setCancelJobId(JID) {

            $("#cancelJobId").val(JID)
        }
        function modalJobCancel() {
            $("#cancelJobId").val($("#jid").val());
            //cancelJob();
        }
        function cancelJob()
        {
            var jobId = $("#cancelJobId").val();
            $("#cancelJobId").val("");
            $.ajax({
                type: "POST",
                 url: '@Url.Action("CancelJob", "Admin")',
                 data: { JobId: jobId },
                 dataType: "json",

                success: function (message) {
                    if (message == 1) {
                        //alert("Job is canceled Successfully.");
                    }
                    else {
                        //alert("Sorry, Job cannot cancel");
                    }

                 },
                error: function (e, text, string) {
                    //alert("Sorry, Job cannot cancel");
                 }
            });
            location.reload(true);
            window.location.reload(true);

        }

    function editJob() {

            $(".allocateBtn").hide();
            $(".jobEditGroup").removeAttr("readonly");
            $(".edit").removeAttr("hidden");
            $(".saveButton").show();


            //editJobId
        }




    function saveJob() {
        {
            var txt = $("#jobId").val();
            $(".saveButton").hide();
            $(".allocateBtn").hide();

            //var jobID =$("#jobId").html(txt + success.jb.id);
            var jobID = $("#jid").val();
            var distance = $("#distance").val();
            var price = $("#price").val();
            var time = $("#time").val() + " " + $("#date").val();
            var driverMessage = $("#driverMessage").val();

            var name = $("#name").val();
            var phone = $("#phone").val();

            //alert(" " + jobID + "\n" + distance + "\n" + price + "\n" + time + "\n" + driverMessage + "\n" + name + "\n" + phone);

            $.ajax({
                type: "POST",
                url: '@Url.Action("SaveJob", "Admin")',
                data: {

                    Id: jobID,
                    PhoneNo: phone,
                    PName: name,
                    Time: time,
                    DriverMessage: driverMessage,
                    Distance: distance,
                    Price: price

                },
                dataType: "json",

                success: function (success) {

                    alert("success" + success)

                },
                error: function (e, text, string) {
                    alert(e.message + text + string);
                    console.log(e);
                }
            });
            location.reload(true);
            window.location.reload(true);

        }


    }

    function allocateJob() {
        $(".saveButton").hide();
        $(".allocateBtn").show();
        $(".DriverDropdown").removeAttr("hidden");

        }

        function DirectAllocateJob(Id) {
            jobInfo(Id);
            $(".DriverDropdown").removeAttr("hidden");
            $(".saveButton").hide();
            $(".allocateBtn").show();


        }

    function allocateJobToDriver() {


            var driverId = $("#drivers").val();

            if ($("#drivers").val() == 0) {
                $("#drivers").addClass("border-danger");
                //alert("Select driver before allocate!");
            }
            else {
                var txt = $("#jobId").val();

                //var jobID =$("#jobId").html(txt + success.jb.id);
                var jobID = $("#jid").val();

                var pickUpAddress = $("#pickUpAddress").val();
                var dropOffAddress = $("#dropOffAddress").val();
                var distance = $("#distance").val();
                var price = $("#price").val();

                //var carType = ("#carType").value();
                //var dAndT = "" + success.jb.dateAndTime;


                var time = $("#time").val() +" "+ $("#date").val();
                //alert("" + time);
                var driverMessage = $("#driverMessage").val();

                var name = $("#name").val();
                var phone = $("#phone").val();
                //alert("" + driverId);
                //alert("ALLOCATE dr_id :" +driverId+" " + jobID + " " + time + " " + phone + " " + distance + " " + price);

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("AllocateJob", "Admin")',
                    data: {

                        Id: jobID,
                        DriverId: driverId,
                        PhoneNo: phone,
                        PName: name,
                        Time: time,
                        DriverMessage: driverMessage,
                        Distance: distance,
                        Price: price

                    },
                    dataType: "json",

                    success: function (success) {

                        //alert("success" + success)

                    },
                    error: function (e, text, string) {
                        //alert(e.message + text + string);
                        console.log(e);
                    }
                });
                window.location.reload(true);

        }
        location.reload(true);
        window.location.reload(true);
        }


        </script>
        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.0.min.js"></script>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
        <script>
            //Search Page Query
            $(document).ready(function () {

                function Contains(text_one, text_two) {
                    if (text_one.indexOf(text_two) != -1)
                        return true;

                }
                $("#search").keyup(function () {
                    var searchtext = $("#search").val().toLowerCase();
                    $(".search").each(function () {
                        if (!Contains($(this).text().toLowerCase(), searchtext)) {
                            $(this).hide();
                        }
                        else {
                            $(this).show();
                        }
                    });
                });
            });

        </script>

    }